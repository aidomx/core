var ne=Object.defineProperty,se=Object.defineProperties;var ae=Object.getOwnPropertyDescriptors;var j=Object.getOwnPropertySymbols;var ie=Object.prototype.hasOwnProperty,ce=Object.prototype.propertyIsEnumerable;var F=(e,t,o)=>t in e?ne(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,S=(e,t)=>{for(var o in t||(t={}))ie.call(t,o)&&F(e,o,t[o]);if(j)for(var o of j(t))ce.call(t,o)&&F(e,o,t[o]);return e},v=(e,t)=>se(e,ae(t));var f="CJ1sUcqGXq8OYIBKMLAdft+onbRgu8V2Pze8oW71SH8=",W="ghost-",U="zJ0/GitvAfL5OIuW+Om/QrtU8vRgFncbUcanmRYOFaE=",fe="IzfdTfnpiLOcnNuJKH/zFm6nU1gSYooF6teBeYN8jqA=";var J,O=(J=process.env.RULES_SECRET_KEY)!=null?J:"your-secret-key";var be=["onClick","onDoubleClick","onMouseDown","onMouseUp","onMouseEnter","onMouseLeave","onMouseMove","onMouseOut","onMouseOver","onKeyDown","onKeyPress","onKeyUp","onFocus","onBlur","onChange","onInput","onSubmit","onReset","onInvalid","onCompositionEnd","onCompositionStart","onCompositionUpdate","onDrag","onDragEnd","onDragEnter","onDragExit","onDragLeave","onDragOver","onDragStart","onDrop","onCopy","onCut","onPaste","onTouchCancel","onTouchEnd","onTouchMove","onTouchStart","onPointerDown","onPointerMove","onPointerUp","onPointerCancel","onPointerEnter","onPointerLeave","onPointerOver","onPointerOut","onAbort","onCanPlay","onCanPlayThrough","onDurationChange","onEmptied","onEncrypted","onEnded","onLoadedData","onLoadedMetadata","onLoadStart","onPause","onPlay","onPlaying","onProgress","onRateChange","onSeeked","onSeeking","onStalled","onSuspend","onTimeUpdate","onVolumeChange","onWaiting","onError","onLoad","onAnimationStart","onAnimationEnd","onAnimationIteration","onTransitionEnd","onScroll","onResize","onContextMenu","onFocusCapture","onBlurCapture","onChangeCapture","onInputCapture","onClickCapture","onSubmitCapture"];var q=["address","article","aside","footer","header","h1","h2","h3","h4","h5","h6","main","nav","section","blockquote","dd","div","dl","dt","figcaption","figure","hr","li","ol","p","pre","ul","a","abbr","b","bdi","bdo","br","cite","code","data","dfn","em","i","kbd","mark","q","rb","rp","rt","rtc","ruby","s","samp","small","span","strong","sub","sup","time","u","var","wbr","del","ins","area","audio","img","map","track","video","iframe","embed","object","param","picture","source","canvas","form","input","textarea","button","select","optgroup","option","label","fieldset","legend","datalist","output","progress","meter","details","dialog","summary","table","caption","colgroup","col","tbody","thead","tfoot","tr","td","th","slot","template"];function D(e){try{let t=JSON.stringify(e);return btoa(encodeURIComponent(t))}catch(t){return console.warn("Failed to encode data:",t),""}}function Me(e){try{let t=decodeURIComponent(atob(e));return JSON.parse(t)}catch(t){return console.warn("Failed to decode data:",t),null}}var l=new Map,x=new Map,P=new Map;var I=e=>JSON.parse(JSON.stringify(e));var V=(e,t)=>{let o=Math.random().toString(36).substring(2,5);return t?e+"_"+t:e+"_"+o};var n=e=>{process.env.NODE_ENV!=="production"&&console.warn(`[WARN]: ${e}`)};var B=e=>Array.isArray(e)?e:Object.entries(e).map(([t,o])=>({pathname:t,name:o}));var Q=(e,t)=>{if(t!=null&&t.debug)return!0;if(typeof window!="undefined"){let o=window.location.pathname;if(t!=null&&t.routes){if(Array.isArray(t.routes))return!1;if(B(t.routes).some(_=>_.name.includes(e)&&_.pathname===o))return!0}if(t!=null&&t.root){if(typeof t.root=="string")return t.root===o;if(Array.isArray(t.root))return t.root.includes(o)}}return!1};var Qe=(e,t)=>{if(e===t)return!0;if(!e||!t)return!1;let o=Object.keys(e),h=Object.keys(t);if(o.length!==h.length)return!1;for(let w of o)if(e[w]!==t[w])return!1;return!0};var X=e=>{let t=O;if(!t)return n("RULES_SECRET_KEY is not defined. Rules were not secured."),{};let o=v(S({},e),{__aidomx__:t});l.set(f,o);let h=l.get(f);return process.env.NODE_ENV==="production"?Object.freeze(h):h};var St=e=>{if(!O)throw new Error("RULES_SECRET_KEY is not defined. Cannot define rules.");return X(e)};var Z=(e,t)=>{let o=D({id:e}),h=()=>{if(!t)throw new Error("No rules found in cache.");return P.has(o)||P.set(o,[]),_()},w=async()=>{var C;let i=(C=t.components)==null?void 0:C.find(R=>R.name===e);if(!i)return n(`Component with pathId ${e} not found.`);Array.isArray(i.data)||(i.data=[]);let m=_(),d=t.debug?t:D(m);m.map(R=>{var y;return(y=i.data)==null?void 0:y.push(I(R))}),l.set(f,d)},_=()=>{let i=P.get(o);return Array.isArray(i)?i:(P.set(o,[]),[])},T=async i=>Array.isArray(i)?(P.set(o,i),await w(),i):(n("next() expects an array of data"),[]);return{add:async i=>{var m;try{let d=h();if(!Array.isArray(i))return n("Data must be an array when using ctx.add");let C=(m=d==null?void 0:d.length)!=null?m:0,y=i.map((b,A)=>{let H=`${e}.${C+A+1}`;return S({id:H},b)}).filter(b=>!d.some(A=>A.id===b.id));return y.length===0?n("No new data added; all entries already exist."):await T(y)}catch(d){return n(`Failed add data with error : ${d.message}`)}},get:async i=>{try{let m=h();return!(i!=null&&i.select)||Object.keys(i==null?void 0:i.select).length===0?_():(Array.isArray(m)?m:[]).map(R=>{let y={},b=i.select;for(let A in b)b[A]&&A in R&&(y[A]=R[A]);return y})}catch(m){n(`Error getting rules: ${m.message}`)}},update:async(i,m)=>{try{let d=h(),C=Array.isArray(d)?[...d]:[],R=C.findIndex(A=>A.id===i);if(R===-1)return n(`No data found to update in component ${e}.`);let y=C[R],b=m(y);return C[R]=S(S({},y),b),await T(C)}catch(d){return n(`Update failed with error: ${d.message}`)}},remove:async i=>{try{let m=h(),d=Array.isArray(m)?[...m]:[],C=d.findIndex(y=>y.id===i);d.splice(C,1);let R=d.map((y,b)=>v(S({},y),{id:`${e}.${b+1}`}));return await T(R)}catch(m){return n(`Remove item failed because ${m.message}`)}},reset:async()=>{try{let i=h();return Array.isArray(i)&&P.clear(),i}catch(i){return n(`Reset failed with error: ${i.message}`)}}}};var $=class{constructor(t,o){this.rules=l.get(f);this.isRulesValid=!1;this.path=t,this.callback=o,this.isRulesValid=this.validateRules(),this.isRulesValid&&this.initialize()}connect(t){return console.log("Connecting to environment:",t),this}async initialize(){this.guardPathAccess();let t=Z(this.path,this.rules);return await this.callback(t)}guardPathAccess(){if(!Q(this.path,this.rules))throw new Error(`Access to '${this.path}' is not allowed on this route.`)}validateRules(){var o;return this.rules?!this.rules.root||!this.rules.components?(n("Please, set your components rules."),!1):(o=this.rules)!=null&&o.components?this.rules.components.some(h=>h.name===this.path)?!0:(n(`Component '${this.path}' not found.`),!1):(n("Ghost components not ready used."),!1):(n("Rules not initialized. Please defineRules first."),!1)}},ee=(e,t)=>new $(e,t);var ue=()=>({rupa:ee}),te=e=>pe(e)?ue():{},pe=e=>{if(!l.has(f))return n("Please, initialize with defineRules before calling createStore."),!1;if(!("__aidomx__"in e))return n("Rules signature is missing. Please use defineRules to initialize rules."),!1;if(!e.root||!Array.isArray(e.components))return n("Rules structure is invalid. Expected root and components fields."),!1;let o=l.get(f);return!o||o.__aidomx__!==e.__aidomx__?(n("Provided rules do not match the cached rules."),!1):!0};var k=(e="components")=>D({id:W+e});var re=e=>{let t=D(e),o=l.has(f),h=(r="")=>{if(!e)throw new Error("No rules found in cache.");let s=k(r);return x.has(s)||x.set(s,[]),T(s)},w=r=>{let s=M();if(Array.isArray(s)&&s.length>0){let{rupa:a}=te(e);return r(a)}},_=r=>(r.map(s=>K(s)),r),T=(r="")=>x.get(r),M=()=>x.get(U),N=r=>{try{return!r||!Array.isArray(r.entries)?[]:r.entries.map(a=>{var g,E,G;return q.includes((E=(g=a.design)==null?void 0:g.type)!=null?E:"")||n(`Tag <${(G=a.design)==null?void 0:G.type}> is not supported.`),r.autoCompile&&K(a),a})}catch(s){return n(`Failed to create ghost: ${s.message}`),[]}},K=r=>{var p,g;if(!r||!r.name||!((p=r.design)!=null&&p.type)){n("Invalid ghost element for compilation.");return}let s=I(r),a=e.debug?e:t;e!=null&&e.components&&e.components.push(s),x.set(k(r.name),[r]),x.set(U,(g=e.components)!=null?g:[]),l.set(f,a)},Y=r=>{h(r);let s=M(),a=s.find(E=>E.name===r),p=v(S({},a),{name:r+"_cloned"}),g=I(p);return x.has(r+"_cloned")?(n(`Clone failed because ${r} have already cloned.`),p):(s.push(g!=null?g:a),x.set(r+"_cloned",s),x.set(U,s),p)},z=r=>{let s=h(r);return Array.isArray(s)?s:(n(`Ghost component with id ${r} not found`),[])},i=(r,s)=>{let a=h(r),{count:p,design:g,contents:E,map:G,randomId:oe}=s;if(Array.isArray(E)&&E.length===p&&!oe){for(let L=0;L<p;L++)a.push({name:V(r,L+1),design:v(S({},g),{content:E[L]})});return _(m(a,G))}if((E==null?void 0:E.length)!==p){n("Count does not match contents length.");return}for(let L=0;L<p;L++)a.push({name:V(r),design:S({},g)});return _(m(a,G))},m=(r,s)=>typeof s=="function"&&Array.isArray(r)?r.map((a,p)=>s(a,p)):r,d=!1,C=r=>{let s=h(r),a=M();try{if(!Array.isArray(s))return n(`Ghost component with id ${r} not found.`),!1;if(x.delete(k(r))){let g=a.findIndex(E=>E.name===r);return a==null||a.splice(g,1),e.components=a,x.set(U,a),l.set(f,e.debug?e:t),!0}return!1}catch(p){return n(`Failed delete component with id ${r} because with error : ${p.message}`),!1}},R=()=>(l.clear(),x.clear(),e.components=[],l.set(f,e.debug?e:t),!0),y=()=>{try{if(!o)return n("Please, setup your rules."),{};let r=l.get(f);return!(r!=null&&r.root)||!(r!=null&&r.components)?(n("Invalid rules, rules is not ready used."),{}):Array.isArray(r.components)?r:(n("Rules successfully, but ghost components is not ready used."),{})}catch(r){return n(`Push rules is failed with error : ${r.message}`),{}}},b=()=>{if(!o)return n("Ghost components is not ready used."),{};let r=M();return A(r)},A=r=>{let s={};for(let a of r)a!=null&&a.name&&(s[a.name]=a);return s};return{createGhost:N,connect:w,cloneGhost:Y,isGhostReady:o,summonGhost:z,spawnGhosts:i,maintenance:d,removeGhost:C,resetGhost:R,pullGhost:b,pushGhost:y,sortGhost:r=>{let s=M(),a=s.findIndex(G=>G.name===r.from),p=s.findIndex(G=>G.name===r.to);if(a===-1&&p===-1||r.from===r.to)return s;let[g]=s.splice(a,1),E=p>a?p-1:p;return s.splice(E+1,0,g),_(s)}}};var le=()=>{let e=l.get(f);return S({},re(e))},ir=e=>me(e)?le():{},me=e=>{if(!l.has(f))return n("Please, initialize with defineRules before calling createStore."),!1;if(!("__aidomx__"in e))return n("Rules signature is missing. Please use defineRules to initialize rules."),!1;if(!e.root||!Array.isArray(e.components))return n("Rules structure is invalid. Expected root and components fields."),!1;let o=l.get(f);return!o||o.__aidomx__!==e.__aidomx__?(n("Provided rules do not match the cached rules."),!1):!0};export{f as CACHE_KEY_RULES,W as GHOST_ELEMENT_ID,U as GHOST_KEY_RULES,O as RULES_SECRET_KEY,fe as STORE_KEY_RULES,te as createStore,ir as createVirtual,Me as decodeData,I as deepClone,St as defineRules,D as encodeData,be as eventMaps,V as generateId,q as ghostElements,n as logWarning,B as normalizeRules,Q as resolvedPath,X as secureRules,Qe as shallowEqual};
//# sourceMappingURL=index.js.map